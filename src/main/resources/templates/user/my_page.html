<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>On&Home - 마이페이지</title>
  <link rel="stylesheet" href="/css/import.css" />
  <script src="/js/oncommon.js"></script>
</head>
<body>
  <!-- 백그라운드 -->
  <div class="on-main-wrap">
    <!-- 헤더 -->
      <div th:replace="~{fragments/header :: header}"></div>

    <!-- 마이페이지 컨텐츠 -->
    <div class="on-item02 mb-80 mt-80">
      <div class="on-item02-inner">
        <h2 class="sub-title line-under">My page</h2>
        <div class="my_page-wrapper">

          <a href="/user/my_order">
            <div class="my_page-obj">
              <span class="ico-mypage order_ico"></span>
              <span>주문내역</span>
            </div>
          </a>
          <a href="/user/cart">
            <div class="my_page-obj">
              <span class="ico-mypage cart_ico"></span>
              <span>장바구니</span>
            </div>
          </a>                       
          <a href="/user/my_info">
            <div class="my_page-obj">
              <span class="ico-mypage info_ico"></span>
              <span>내정보</span>
            </div>
          </a>
        </div>
      </div>
    </div>  

    <!-- 푸터 -->
    <footer class="footer-o">
      <div class="footer-wrapper">
        <div class="footer-l">
          <div>고객센터 <span class="footer-number">1544-7777</span></div>
          <div class="flex mt-20">
            <div>
              <ul class="footer-title">
                <li>회사명</li>
                <li>대표</li>
                <li>팩스</li>
                <li>이메일</li>
                <li>주소</li>
                <li>사업자등록번호</li>
                <li>통신판매업신고</li>
                <li>개인정보 책임자</li>
              </ul>
            </div>
            <div class="ml-20">
              <ul class="footer-title">
                <li>(주)하이미디어</li>
                <li>이상혁</li>
                <li>02-1544-7778</li>
                <li>faker@naver.com</li>
                <li>서울 서초구 서초동 123-456</li>
                <li>123-456789</li>
                <li>카456-7894</li>
                <li>최우제</li>
              </ul>
            </div>            
          </div>
        </div>
        <div class="footer-r">
          <div>
            <span class="footer-number">Review 게시판</span>
            <div class="footer-review">
              <ul class="footer-title">
                <li>배송 빠르고 좋아요!</li>
                <li>포장 꼼꼼해서 만족합니다</li>
                <li>색감 실물이 더 예뻐요</li>
                <li>가격대비 품질이 훌륭합니다</li>
                <li>설치 기사님 친절했어요</li>
                <li>두 번째 구매인데 역시 좋네요</li>
                <li>응대가 빠르고 친절합니다</li>
              </ul>
            </div>
          </div>
          <div>
            <span class="footer-number">Q&A 게시판</span>
            <div class="footer-review">
              <ul class="footer-title">
                <li>배송 빠르고 좋아요!</li>
                <li>포장 꼼꼼해서 만족합니다</li>
                <li>색감 실물이 더 예뻐요</li>
                <li>가격대비 품질이 훌륭합니다</li>
                <li>설치 기사님 친절했어요</li>
                <li>두 번째 구매인데 역시 좋네요</li>
                <li>응대가 빠르고 친절합니다</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </footer>     
  </div>

  <script>
    /**
     * 로그인 상태에 따라 헤더 네비게이션을 동적으로 변경
     */
    document.addEventListener('DOMContentLoaded', function() {
      // 서버에서 로그인 정보 확인
      fetch('/api/user/session-info')
        .then(response => response.json())
        .then(data => {
          const headerNav = document.getElementById('headerNav');
          headerNav.innerHTML = '';  // 기존 내용 제거

          if (data.loggedIn) {
            // 로그인 상태
            let navHTML = `
              <li><a href="/user/my_page">마이페이지</a></li>
              <li><a href="/user/board/notice/list">공지사항</a></li>
            `;

            // Admin 계정이면 관리자 링크 추가
            if (data.isAdmin) {
              navHTML += `<li><a href="/admin/dashboard"><b>관리자</b></a></li>`;
            }

            // 로그아웃 링크
            navHTML += `
              <li><a href="#" onclick="handleLogout(); return false;">로그아웃</a></li>
            `;

            headerNav.innerHTML = navHTML;
          } else {
            // 비로그인 상태 (로그인 페이지로 리다이렉트할 수 있음)
            // 마이페이지는 로그인 필수 페이지이므로 로그인 페이지로 리다이렉트
            window.location.href = '/login';
          }
        })
        .catch(error => {
          console.error('세션 정보 조회 실패:', error);
          // 오류 발생 시 로그인 페이지로 리다이렉트
          window.location.href = '/login';
        });
    });

    /**
     * 로그아웃 처리
     */
    function handleLogout() {
      if (confirm('로그아웃 하시겠습니까?')) {
        window.location.href = '/logout';
      }
    }
  </script>
</body>
</html>
